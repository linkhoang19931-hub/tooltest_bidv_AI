<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BIDV AI Test Runner</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10">
  <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-3xl">
    <h1 class="text-2xl font-bold mb-6 text-center text-blue-600">üöÄ BIDV AI Test Runner</h1>

    <!-- Upload Excel -->
    <label class="block mb-2 font-semibold">1Ô∏è‚É£ Ch·ªçn file Excel ƒë·∫ßu v√†o:</label>
    <input type="file" id="excelFile" accept=".xlsx" class="block w-full border border-gray-300 p-2 rounded mb-4" />

    <!-- Select functions -->
    <label class="block mb-2 font-semibold">2Ô∏è‚É£ Ch·ªçn ch·ª©c nƒÉng mu·ªën ch·∫°y:</label>
    <div class="grid grid-cols-2 gap-2 mb-4">
      <label class="flex items-center gap-2">
        <input type="checkbox" value="init_test" checked> init_test
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" value="get_chatbot_output" checked> get_chatbot_output
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" value="ref_check" checked> ref_check
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" value="get_llm_check_output" checked> get_llm_check_output
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" value="get_llm_check_bone_output" checked> get_llm_check_bone_output
      </label>
    </div>

    <!-- Start button -->
    <button id="runBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">B·∫Øt ƒë·∫ßu ch·∫°y</button>

    <!-- Logs -->
    <div id="logBox" class="mt-6 bg-gray-50 p-4 rounded-md h-64 overflow-y-auto text-sm font-mono border border-gray-200"></div>
  </div>

  <script>
    const logBox = document.getElementById("logBox");

    function log(message) {
      logBox.innerHTML += `<div>${new Date().toLocaleTimeString()} ‚ñ∂Ô∏è ${message}</div>`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    document.getElementById("runBtn").addEventListener("click", async () => {
      const fileInput = document.getElementById("excelFile");
      const file = fileInput.files[0];
      if (!file) {
        alert("H√£y ch·ªçn file Excel tr∆∞·ªõc!");
        return;
      }

      const selectedFuncs = Array.from(document.querySelectorAll("input[type='checkbox']:checked"))
        .map(cb => cb.value);
      log(`B·∫Øt ƒë·∫ßu upload file v√† ch·∫°y c√°c ch·ª©c nƒÉng: ${selectedFuncs.join(", ")}`);

      const formData = new FormData();
      formData.append("file", file);
      formData.append("functions", selectedFuncs.join(","));

      try {
        const res = await fetch("http://localhost:8000/run", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        log(`‚úÖ K·∫øt qu·∫£: ${JSON.stringify(data, null, 2)}`);
      } catch (e) {
        log(`‚ùå L·ªói khi g·ªçi API: ${e}`);
      }
    });
  </script>
</body>
</html>
